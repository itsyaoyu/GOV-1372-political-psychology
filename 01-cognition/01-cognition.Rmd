---
title: 'Data Exploration: Making Decisions'
author: "Yao Yu"
date: "September 9, 2021"
output:
  pdf_document: default
  html_document:
    df_print: paged
urlcolor: blue
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(infer)
library(gt)
library(estimatr) # difference_in_means()
```

In this Data Exploration assignment, you have two separate data sets with which you will work. The first involves the data generated by you and your classmates last week when you took the in-class survey. The second involves some of the data used in the Atkinson et al. (2009) piece that you read for class this week. Both data sets are described in more detail below.

If you have a question about any part of this assignment, please ask! Note that the actionable part of each question is **bolded**.

# Part 1: Cognitive Biases

You may have noticed that the questions on the survey you took during class last week were based on the Kahneman (2003) reading you did for this week. The goal for this set of questions is to examine those data to see if you and your classmates exhibit the same cognitive biases that Kahneman wrote about. The data you generated is described below.

**Data Details:**

* File Name: \texttt{bias\_data.csv}

* Source: These data are from the in-class survey you took last week. 

Variable Name         | Variable Description
--------------------- | --------------------------------------
\texttt{id}         | Unique ID for each respondent
\texttt{rare\_disease\_prog}  | From the rare disease problem, the program chosen by the respondent (either 'Program A' or 'Program B')
\texttt{rare\_disease\_cond}  | From the rare disease problem, the framing condition to which the respondent was assigned (either 'save' or 'die')
\texttt{linda}  | From the Linda problem, the option the respondent thought most probable, either "teller" or "teller and feminist"
\texttt{cab}  | From the cab problem, the respondent's estimate of the probability the car was blue
\texttt{gender}  | One of "man", "woman", "non-binary", or "other"
\texttt{year}  | Year at Harvard
\texttt{college\_stats}  | Indicator for whether or not the respondent has taken a college-level statistics course

Before you get started, make sure you replace "file_name_here_1.csv" with the name of the file. (Also, remember to make sure you have saved the .Rmd version of this file and the file with the data in the same folder.)
```{r biases, message = FALSE}
# load the class-generated bias data
bias_data <- read_csv("data/bias_data.csv")
```

\newpage

## Question 1
First, let's look at the rare disease problem. You'll recall from the Kahneman (2003) piece that responses to this problem often differ based on the framing (people being saved versus people dying), despite the fact that the two frames are logically equivalent. This is what is called a 'framing bias'.

**Did you all exhibit this bias? Since the outcomes for this problem are binary, we need to test to see if the proportions who chose Program A under each of the conditions are the same. Report the difference in proportions who chose Program A under the 'save' and 'die' conditions. Do we see the same pattern that Kahneman described?**


**EXTENSION: Report the 95% confidence interval for the difference in proportions you just calculated. Hint: the `infer` package has a function that is useful here. What does the 95% confidence interval mean?**

Note that extensions to questions are not the same as data science questions. Complete this question if you like, but it is not required for data science students like actual data science questions.

```{r question 1}
# Calculating the proportions of respondents who chose Program A under the save
# and die conditions
bias_data %>% 
  filter(rare_disease_prog == "Program A") %>% 
  count(rare_disease_cond) %>% 
  mutate(n = round(n / sum(n), digits = 3)) %>% 
  gt() %>%
  tab_header(title = "Respondents who chose Program A") %>%
  cols_label(
    rare_disease_cond = "Condition",
    n = "Proportion of responses"
  )

# Calculating the 95% confidence interval
prop_test(bias_data, rare_disease_prog ~ rare_disease_cond, 
          conf_level = .95, order = c("die", "save"))
```

From the table, we can see that a higher proportion of respondents chose Program A under the save condition. This reflects the same pattern that Kahneman described in Prospect Theory that people tend to be more loss adverse. The 95% confidence interval supports this theory further because it tells us that at a 95% confidence level, we can say that the difference in proportion between participants who choose Program A under the "save" and "die" conditions is between 0.543 and 0.093.

\newpage

## Question 2
Now let's move on to the Linda problem. As we read in Kahneman (2003), answers to this problem tend to exhibit a pattern called a "conjunction fallacy" whereby respondents overrate the probability that Linda is a bank teller \textit{and} a feminist rather than just a bank teller. From probability theory, we know that the conjunction of two events A and B can't be more probable than either of the events occurring by itself; that is, $P(A) \ge P(A \wedge B)$ and $P(B) \ge P(A \wedge B)$\footnote{The symbol $\wedge$ is used in logical expressions to mean "AND". If there are two conditions, A and B, then $A \wedge B$ is true only when both A and B are separately true. The expression $P(A) \ge P(A \wedge B)$ is therefore interpreted as: "The probability A is true is greater than or equal to the probability that both A and B are true.}.

**What proportion of the class answered this question correctly? Why do you think people tend to choose the wrong option?**

```{r question 2}
# Calculating the proportion of the class answered this question correctly
bias_data %>% 
  count(linda) %>% 
  mutate(n = round(n / sum(n), digits = 3)) %>% 
  gt() %>% 
  tab_header(title = "How the class responded to the Linda problem") %>% 
  cols_label(
    linda = "Choice",
    n = "Proportion of responses"
  )
```

A fairly high proportion of students in the class, around 70%, answered the Linda problem correctly. I think most people tend to choose the wrong option because they use the representativeness heuristic to make a quick judgment. Becuase Linda appears to be more representative of a feminist, people are naturally drawn to connect her as a feminist even though it is statistically not as likely as Linda being just a bank teller.

\newpage

## Question 3

**What attributes of the respondents do you think might affect how they answered the Linda problem and why? Using the data, see if your hypothesis is correct.**

```{r Question 3}
# Evaluating if the responses are different among students who have studied
# stats and those have not
bias_data %>% 
  count(college_stats, linda) %>% 
  group_by(college_stats) %>% 
  mutate(n = round(n / sum(n), digits = 3)) %>% 
  arrange(desc(college_stats)) %>% 
  pivot_wider(names_from = "college_stats", values_from = "n") %>% 
  gt() %>% 
  tab_header(title = "Responses to the Linda problem based on stats background") %>% 
  cols_label(
    linda = "Choice",
    Yes = "Stats",
    No = "No Stats"
  )
```

I hypothesized that students who have a stats background are less likely to be fooled by the Linda problem. The data provides initial support for my hypothesis in that a higher proportion of students with a stats background correctly chose "teller" compared to studnets without a stats background.

\newpage

## Question 4: Data Science Question
Now we will take a look at the taxi cab problem. This problem, originally posed by Tversky and Kahneman in 1977, is intended to demonstrate what they call a "base rate fallacy". To refresh your memory, here is the text of the problem, as you saw it on the survey last week:

\begin{quote}
  A cab was involved in a hit and run accident at night. Two cab companies, the Green and the Blue, operate in the city. 85% of the cabs in the city are Green and 15% are Blue.
  
  A witness identified the cab as Blue. The court tested the reliability of the witness under the same circumstances that existed on the night of the accident and concluded that the witness correctly identified each one of the two colours 80% of the time and failed 20% of the time.
  
  What is the probability that the cab involved in the accident was Blue rather than Green knowing that this witness identified it as Blue?
\end{quote}

The most common answer to this problem is .8. This corresponds to the reliability of the witness, without regard for the base rate at which Blue cabs can be found relative to Green cabs. In other words, respondents tend to disregard the base rate when estimating the probability the cab was Blue.

**What is the true probability the cab was Blue? Visualize the distribution of the guesses in the class using a histogram. What was the most common guess in the class?**

$$
\begin{aligned}
P(A\vert B) &= \frac{P(B\vert A)P(A)}{P(B)} \\
&= \frac{P(B\vert A)P(A)}{P(B\vert A)P(A)+P(B\vert A^c)P(A^c)}\\
\\
P(A) &= \text{Blue} \\
P(B) &= \text{Witness says Blue} \\
\\
P(A\vert B) &= \frac{(0.8)(0.15)}{(0.8)(0.15)+(0.2)(0.85)} \\
&= \frac{0.12}{0.12+0.17} \\
&\approx 0.414
\end{aligned}
$$

```{r Question 4}
# Creating a histogram showing the distribution of class responses
bias_data %>% 
  drop_na(cab) %>% # Remvoing NA guesses
  ggplot(aes(x = cab)) +
  geom_histogram(binwidth = .05, fill = "#00bfc4") +
  theme_linedraw() +
  labs(
    title = "Distribution of student responses to the cab problem",
    x = "Student guess that the probability of the cab is blue",
    y = "Count"
  )

# Finding the most common Guess
most_commomn_guess <- bias_data %>% 
  count(cab) %>% 
  arrange(desc(n)) %>% 
  head(1) %>% 
  pull(cab)

print(most_commomn_guess)
```

In the cab problem, we can see that the correct answer is about 41.4% that the cab was actually blue based on the witness's testimony. However, the most common response among the students was 80%.

\newpage

# Part 2: Political Faces

Now you will investigate some of the data used in Atkinson et al. (2009). These data cover Senate candidates from 1992-2006 and include face ratings, partisanship, incumbent status, and other variables. 

**Data Details:**

* File Name: \texttt{senate\_data.csv}

* Source: These data are condensed and adapted from the [replication data](https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/RSI8NR) for Atkinson et al. (2009).

Variable Name         | Variable Description
--------------------- | --------------------------------------
\texttt{cook}         | The assessment of the Senate race from the Cook Political Report in the year prior to the election
\texttt{year}         | The year of the election
\texttt{state}        | The state in which the candidate was running
\texttt{face\_rating}  | The normalized rating of the candidate's perceived competence based on an image of the face
\texttt{incumbent}    | An indicator variable for whether the candidate was an incumbent
\texttt{candidate}    | The candidate's name
\texttt{party}        | The candidate's political party
\texttt{tossup}       | An indicator variable for whether the race was one of two "tossup" categories according to Cook
\texttt{jpg}         | A unique identifier for the photo of the candidate

As before, make sure you replace "file_name_here_2.csv" with the name of the file.

```{r faces, message=FALSE}
face_data <- read_csv("data/senate_data.csv")
```

As an example of how you might write your own code to analyze these data, let's take a look at whether there was a difference in the perceived competence of Democratic and Republican candidates' faces. We can examine this question graphically using a density plot.

```{r}
# make density plot of perceived competence by party
feature_img <- ggplot(data = face_data, aes(x = face_rating, color = party)) + # note that by setting color = party, 
  geom_density() +                                              # the face ratings of each party will be 
  theme_light() +                                               # displayed in different colors
  labs(title = "Perceived Competence by Party",
       x = "Face Rating",
       y = "Density",
       color = "Party")

# png("cognition.png", units="in", width=8, height=5, res=300)
# print(feature_img)
# dev.off()
```

We can also consider this statistically using a t-test for whether or not the mean face ratings are significantly different across parties.

```{r}
# conduct a t-test of difference-in-means
difference_in_means(face_rating ~ party, data = face_data)
```

Neither the graphical nor the statistical approaches suggest a significant difference in perceived competence of candidate faces by party.

\newpage

## Question 5
**Do the data suggest a significant difference between perceived competence of incumbent vs. non-incumbent candidate faces? How do your findings relate to the results and theory of Atkinson et al. (2009)?**

```{r Question 5}
# Calculating some summary statistics between incumbent vs. non-incumbent
face_data %>% 
  group_by(incumbent) %>% 
  summarize(min = round(min(face_rating), digits = 3),
            median = round(median(face_rating), digits = 3),
            mean = round(mean(face_rating), digits = 3),
            max = round(max(face_rating), digits = 3),
            .groups = "drop") %>% 
  arrange(desc(incumbent)) %>% 
  gt() %>% 
  tab_header(title = "Difference between perceived competence of incumbent vs. non-incumbent")

# Using a t-test to calculate the significance of the difference between
# incumbents vs. non-incumbents
difference_in_means(face_rating ~ incumbent, data = face_data)
```

From the t-test, we can say that at a 95% confidence level, the difference between perceived competence of incumbent vs. non-incumbent is between an interval of 0.269 and 0.626. In other words, incumbents tend to be perceived as being more competent. This supports the results and theory of Atkinson et al. (2009) that physical appearance matters in how people percieve politicians.

\newpage

## Question 6
**Do the data suggest a significant difference between perceived competence of non-incumbent candidate faces in tossup vs. non-tossup races? What might explain any similarities or differences between these results and those from the previous question? How do your findings relate to the results and theory of Atkinson et al. (2009)?**

```{r Question 6}
# Filtering for only non-incumbents
face_data_non_incumbents <- face_data %>% 
  filter(!incumbent)

# Calculating some summary statistics
face_data_non_incumbents %>% 
  group_by(tossup) %>% 
  summarize(min = round(min(face_rating), digits = 3),
            median = round(median(face_rating), digits = 3),
            mean = round(mean(face_rating), digits = 3),
            max = round(max(face_rating), digits = 3),
            .groups = "drop") %>% 
  arrange(desc(tossup)) %>% 
  gt() %>% 
  tab_header(title = "Difference between perceived competence of non-incumbent candiates in tossup vs. non-tossup races")

# Using a t-test to calculate the significance of the difference in perceived
# competence between tossups and non-tossup races among non-incumbent candidate
difference_in_means(face_rating ~ tossup, data = face_data_non_incumbents)
```

When evaluating the perceived competence of non-incumbent candidate faces in tossup vs. non-tossup races, there is not a statistically significant difference. However, in the summary statistics, we can see that the perceived competence of non-incumbent candidate faces in tossup races on average is still higher than the perceived competence of non-incumbent candidate faces in non-tossup races. This still supports the results and theory of Atkinson et al. (2009) in that physical appearance may still be one factor when deciding which candidates run in closer races.

\newpage

## Question 7: Data Science Question
Atkinson et al. (2009, 236) suggest that "...incumbents from the most competitive districts would have higher facial quality than incumbents from the most safe incumbent districts due to the selection process of better faces to competitive districts, inducing a negative relationship between incumbent face and incumbent vote." **Do the data support the idea that seat safety is negatively correlated with incumbent facial quality? Make a plot to visualize this relationship.** Note that this question may require you to define at least one new variable.

```{r Question 7}
# Plotting face_rating vs competitive among incumbents
# I'm defining competitiveness using four categories based on the Cook rankings:
# 0: Solid
# 1: Likely
# 2: Lean
# 3: Tossup
seat_safety <- face_data %>% 
  filter(incumbent) %>% 
  mutate(competitive = case_when(
    str_detect(cook, "Solid") ~ 0,
    str_detect(cook, "Likely") ~ 1,
    str_detect(cook, "Lean") ~ 2,
    str_detect(cook, "Toss") ~ 3,
    TRUE ~ NA_real_
  )) %>% 
  ggplot(aes(x = competitive, y = face_rating)) +
  geom_jitter(width = 0.25, color = "#00bfc4") +
  geom_smooth(formula = y ~ x, method = "lm") +
  scale_x_continuous(breaks = c(0, 1, 2, 3), labels = c("Solid", "Likely", "Lean", "Tossup")) +
  theme_light() +
  labs(
    title = "Face Rating scores vs race competitiveness among incumbents",
    x = "",
    y = "Face Rating"
  )

# png("seat_safety.png", units="in", width=8, height=5, res=300)
# print(seat_safety)
# dev.off()
```

Under my definition of competitiveness based on the Cook rankings for races, I do not find evidence to support the idea that seat safety is negatively correlated with incumbent facial quality. From my plot, it can be seen that the face rating scores remain relatively steady across all types of competitiveness among incumbents.

\newpage

## Question 8
**Is there something else interesting or informative that you could explore using either of these datasets? If so, run it by a TF and try it out here.**

